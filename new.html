<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 18 January 2014 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20140118" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis Migrations - 
    MyBatis Migrations | Migrate > new</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis Migrations</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.io/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 18 January 2014
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.2.0
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Migrations</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                                                                                                                                                                                                                      
      <li>
  
                          <a href="migrate.html" title="The 'migrate' Command">
          <i class="icon-chevron-down"></i>
        The 'migrate' Command</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="init.html" title="init">
          <i class="none"></i>
        init</a>
            </li>
                    
      <li>
  
                          <a href="bootstrap.html" title="bootstrap">
          <i class="none"></i>
        bootstrap</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>new</a>
          </li>
                    
      <li>
  
                          <a href="status.html" title="status">
          <i class="none"></i>
        status</a>
            </li>
                    
      <li>
  
                          <a href="updown.html" title="up, down">
          <i class="none"></i>
        up, down</a>
            </li>
                    
      <li>
  
                          <a href="version.html" title="version">
          <i class="none"></i>
        version</a>
            </li>
                    
      <li>
  
                          <a href="pending.html" title="pending">
          <i class="none"></i>
        pending</a>
            </li>
                    
      <li>
  
                          <a href="script.html" title="script">
          <i class="none"></i>
        script</a>
            </li>
                    
      <li>
  
                          <a href="shortcuts.html" title="Command Shortcuts">
          <i class="none"></i>
        Command Shortcuts</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="runtime-migration.html" title="Runtime Schema Migration">
          <i class="none"></i>
        Runtime Schema Migration</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2011 The myBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id: new.xml 4119 2011-11-27 19:43:04Z simone.tripodi $ -->

  
    <div class="section">
<h2>The 'new' command<a name="The_new_command"></a></h2>
      
<p>Now that you&#x2019;ve initialized your repository and bootstrapped your existing database schema, you&#x2019;re ready to
      start leveraging the power of MyBatis Migrations!</p>

      
<p>MyBatis Migrations are simple SQL script files (*.sql) that live in the <tt>scripts</tt> directory and
      follow a very strict convention. Since this convention is so important, we don&#x2019;t want to leave it up to humans to
      try to get it right every time... so we let automation do what it does best, and keep things consistent.</p>

      
<p>The <tt>new</tt> command generates the skeleton of a migration script that you can then simply fill in.
      The command is simply run as follows:</p>

      
<div class="source">
<pre>/home/cbegin/testdb$ migrate new &quot;create blog table&quot;</pre></div>

      
<p>The parameter that the new command takes is a comment describing the migration that you're
        creating. You don&#x2019;t need quotes around it, but it helps keep the command readable.</p>

      
<p>When the command is run, it will create a file named something like the following:</p>

      
<div class="source">
<pre>20090807221754_create_blog_table.sql</pre></div>

      
<p>This format is very important (which is why it&#x2019;s generated). The number at the beginning plays three roles.
      Fist, it&#x2019;s a <i>practically unique</i> identifier, meaning it&#x2019;s highly unlikely that two people will generate the
      same one at the same time (it&#x2019;s not a big deal to resolve if it does happen). Second, it&#x2019;s a timestamp, indicating
      when the migration was created. Third, it is an ordinal index, formatted in a way that will keep the migrations
      sorted in the order in which they were created. The remainder of the filename is the comment you specified in the
      parameter. Finally, the suffix is .sql, indicating the file type that most editors will recognize.</p>

      
<p>The contents of the migration script also follows a specific and required pattern.
      Here's the contents of the file we just generated:</p>

      
<div class="source">
<pre>-- // create blog table
-- Migration SQL that makes the change goes here.

-- //@UNDO
-- SQL to undo the change goes here.</pre></div>

      
<p>Notice that your comment once again appears at the top of the file.
      You can add more comments beneath it and throughout the script if you like.</p>

      
<p>The section immediately following that comment is where you would put your DDL commands to create the blog table.</p>

      
<p>Then notice the </p>
<div class="source">
<pre>-- //@UNDO</pre></div> section. This section demarcates the script file sections, splitting
      it into two distinct parts. Only the commands above the undo section will be executed when <i>upgrading</i> a database.
      Everything beneath the undo section will be run when <i>downgrading</i> the database. Both sections are kept in
      the same file for simplicity and clarity. The following is a filled in script:

      
<div class="source">
<pre>-- // create blog table
CREATE TABLE BLOG (
  ID INT,
  NAME VARCHAR(255),
  PRIMARY KEY(ID)
);

-- //@UNDO
DROP TABLE BLOG;</pre></div>

      
<p>Notice that the commands are <b>terminated by a colon</b>. This is also important, and you will receive a
      warning and likely a failure if you don't terminate the SQL statements with a colon.</p>

      
<p>Optionally, you can configure your own template to be consumed by the 'new' command. Configuration requires a
      file named migrations.properties (in <tt>$MIGRATIONS_HOME</tt>). This file will contain the location of your template.</p>

      
<div class="source">
<pre># Example of migration.properties

new_command.template=templates/new_template_migration.sql</pre></div>

      
<p>Alternatively you can manually specify the location of your template as such:</p>

      
<div class="source">
<pre>migrate new &#x2013;template=&lt;path to template&gt; &quot;your description&quot;</pre></div>

      
<p>If neither of these are used, or valid, the default template shown on the previous page will be used.</p>

      
<p>So how do we run this script? Well, first it&#x2019;s probably important to understand the current state of the database.</p>
    </div>
  


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2010&#x2013;2014
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
